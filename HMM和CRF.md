# HMM和CRF

## 1. HMM

### 1.1 模型

HMM模型的参数是三元组：$\lambda =(\pi, A, B)$，解决的问题是给定一个观测序列$O=(o_1, o_2, ..., o_T)$，根据参数生成不可观测的状态序列$I=(i_1, i_2, ...,i_T)$，其中$\pi$是状态序列初始的概率，A叫做转移矩阵，表示状态序列从上一状态到下一状态转移的概率$p(i_t|i_{t-1})$，B叫做发射矩阵，也叫观测概率矩阵，表示从当前状态转移到当前观测值的概率$p(o_t|i_t)$。假设每个状态有N种，观测值有M种，那么三个参数的形状分别是：$(1\times N),(N\times N),(N\times M)$

+ HMM三个假设
  + 马尔科夫假设：t时刻状态只与t-1时刻有关
  + 齐次性假设：马尔科夫链的t时刻的状态只依赖于前一时刻t-1的状态，与其他时刻的观测值和状态以及时刻无关
  + 观测独立性假设：某个时刻t的观测值只依赖于时刻t的状态，与其他观测值和假设无关

+ HMM基本的三个问题

  + 评估问题：已知参数$\lambda=(\pi, A, B)$和观测序列$O(o_1, o_2, ...,o_T)$，计算观测序列出现的概率

    + 穷举出所有可能的状态序列，然后根据状态序列才能计算出这个观测序列出现的概率

    $$
    p(O|\lambda)=\sum_{I}p(O|I, \lambda)p(I|\lambda)
    $$

  + 预测问题：已知参数$\lambda=(\pi, A, B)$和观测序列$O(o_1, o_2, ...,o_T)$，计算最有可能的状态序列

    + 需要用到动态规划的思想

  + 参数学习问题



### 1.2 评估问题

+ 直接求解

  假设$I$代表长度为T的状态序列的所有可能的集合，一共$N^T$种
  $$
  \begin{aligned}
  p(O|\lambda)&=\sum_{I}p(O|I,\lambda)p(I|\lambda)\\
  &=\sum_{I}\pi_{i_1}b_{i_1}(o_1)a_{i_1,i_2}b_{i_2}(o_2)...a_{i_{T-1},i_T}b_{i_T}(o_T)
  \end{aligned}
  $$
  计算的时间复杂度为：$O(T\times N^T)$



+ 前向算法：

  直接求解会有大量重复计算，这里采用前向算法，从长度为1的序列算起，每次记录上一次以$q_k$为最后状态的序列的概率

  首先计算长度为1的序列的概率：
  $$
  \alpha_{i_1}=\pi_{i_1}b_{i_i}(o_1)
  $$
  生成的是一个N维向量，即长度为1的序列的所有可能序列的概率，再计算长度为2的：
  $$
  \alpha_{i_2}=\alpha_{i_1}\bigodot a_{i_1,i_2}b_{i_2}(o_2)
  $$
  这样每次计算引用前一次的计算结果，最终可以计算出：
  $$
  p(O|\lambda)=\sum\alpha_{i_T}
  $$
  时间复杂度变成$O(N^2T)$

+ 后向算法同理



### 1.3 预测序列

+ 简单求法：

  每一时刻都设为概率最大的状态，但是这并不是全局最优解

+ 动态规划：

  每一时刻保留最优的N条路径，然后计算最优路径和下一时刻各个状态转移概率的概率值，选出使得这条路径最大的状态作为N条路径中最优的状态。设$\delta_t(i)$表示t时刻的第i条最优路径的概率值，$\phi_t(i)$表示i时刻使得路径最优的
  
  先计算初始状态：第一个状态的初始概率和从第一个状态转移到第一个观测值的概率相乘
  $$
  \delta_1(i)=\pi_{i}b_i(o_1)\\
  $$
  得到一个N维向量，便于下一次计算最优路径；然后计算t=2时刻的最优路径：
  $$
  \delta_2(i)=[(\delta_1(j)a_{ji})b_i(o_2)](j=1, 2...N)
  $$
  由上式可以计算出$N^2$条路径，此时可以确定N条局部最优的路径，也就是使得在时刻t=2时概率最大的上一状态j：
  $$
  \delta_2(i)=max([(\delta_1(j)a_{ji})b_i(o_2)])\\
  \phi_2(i)=arg \max_j([(\delta_1(j)a_{ji})b_i(o_2)])
  $$
  依次计算t时刻在状态i下使得概率最大的上一状态j，得到t从1到T-1时刻的N条最优路径和概率，最后通过计算最后一个时刻的状态的最优路径和概率，得出结果：
  $$
  \delta_T(i)=max[(\delta_{T}(j)a_{ji})b_i(o_{T})]\\
  \phi_T(i)=arg \max_j[(\delta_{T}(j)a_{ji})b_i(o_{T})]
  $$



## 2. CRF































































